<div id='relay' bodyClass="<?php echo $this->layout()->body_class; ?>"></div>
<section class='page'>

  <div class='sectionHeader'>
    <div class='sectionHeader_top'>
      <div class='grid -clean'>
        <div class='grid_column'>
          <div class='sectionHeader_top_inner'>
            <h1 class='sectionHeader_title'><?php echo $this->translate("Take a Survey");?></h1>
            <div id='sectionInfo_trigger' class='sectionHeader_info' unselectable='on'><i class='icon -infoBlack24'></i></div>
          </div>
        </div>
      </div>
    </div>
    <div id='sectionInfo' class='sectionHeader_bottom' animate>
      <div class='grid -clean'>
        <div class='grid_column'>
          <div class='sectionHeader_description preformat'>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Obcaecati molestiae quod modi consequatur quae aliquid, doloremque id praesentium, quia voluptate ratione repudiandae dicta, ipsum expedita?</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class='grid'>
    <div class='grid_column -medium9 -mediumPlus8'>
      <form action='survey-questions.html' class='survey form' method='post' ajaxForm>

        <div class='form_item'>
          <label class='form_label' for='authentication'><?php echo $this->translate('Please enter your identification number:'); ?></label>
          <div class='form_field'>
            <input class='formInput' type='text' name='' value='' placeholder='ID Number' id='authentication'>
          </div>
        </div>

        <div class='form_item'>
          <label class='form_label' for='date'><?php echo $this->translate('Please enter your date of birth:'); ?></label>
          <div class='form_item_help hide-for-js'>Example: 28/12/2014, or 28.12.2014</div>
          <div class='form_field'>
            <input class='formInput' type='date' placeholder='Day/Month/Year' inputDate>
          </div>
        </div>

        <div class='form_item'>
          <label class='form_label' for='chooseSurvey'><?php echo $this->translate('Choose your survey:'); ?></label>
          <div class='form_field customSelect'>
            <select class='formSelect customSelect_select -custom' id='chooseSurvey'>
              <option><?php echo $this->translate('Your needs assessment'); ?></option>
            </select>
            <a unselectable='on' class='customSelect_overlay'><?php echo $this->translate('Your needs assessment'); ?></a>
          </div>
        </div>

        <div class='grid -compact -reverse'>
          <div class='grid_column -small7'>
            <input class='button -primary -fullWidth' type='submit' value="<?php echo $this->translate('Next'); ?>">
          </div>
          <div class='grid_column -small5'>
            <a class='button -fullWidth' href='menu-page.html' ajaxNav tabindex='0'><?php echo $this->translate('Cancel'); ?></a>
          </div>
        </div>

      </form>
    </div>
  </div>
</section>



<?php $form = $this->form; ?>
<?php $form->setAttribute('class', 'form-horizontal margin-none'); ?>
<?php $form->setAttribute('action', $this->url('survey'))->prepare(); ?>

<div class="separator bottom"></div>
<h3 class="glyphicons notes_2"><?php echo $this->translate('Survey'); ?></h3>
<div class="innerLR">

    <?php echo $this->form()->openTag($form); ?>

    <div class="widget-body col-md-12">
        <div class="tab-content">
            <div class="row">

                <?php
                foreach ($form->getFieldsets() as $fieldset) { ?>

                <fieldset class="widget widget-4">
                    <legend class="widget-head">
                        <h4 class="heading"><?php echo $fieldset->getLabel(); ?></h4>
                    </legend>
                    <div class="widget-body">

                        <?php $parent = false; $prev = null; ?>
                        <?php foreach ($fieldset->getElements() as $formElement) { ?>
                        <?php if ($formElement->getAttribute('data-parent')) {
                        if (isset($prev) && $prev->getAttribute('data-parent') != $formElement->getAttribute('data-parent')) { ?>
                        <a href="#" class="btn btn-icon btn-primary glyphicons circle_plus pull-right"
                           data-subform="<?php echo $prev->getAttribute('data-parent') ?>">
                            <?php echo $this->translate('Add subform'); ?></a>
                        <?php //todo - fix html or implement the better solution ?>
                        <br/><br/>
                    </div></div>
            <div class="widget widget-4">
                <legend class="widget-head">
                    <h4 class="heading"><?php echo $formElement->getAttribute('data-groupLabel'); ?></h4>
                </legend>
                <div class="surveyRepeat_<?php echo $formElement->getAttribute('data-parent'); ?>">
                    <?php } else if (!$parent) { ?>
                    <div class="widget widget-4">
                        <legend class="widget-head">
                            <h4 class="heading"><?php echo $formElement->getAttribute('data-groupLabel'); ?></h4>
                        </legend>
                        <div class="surveyRepeat_<?php echo $formElement->getAttribute('data-parent'); ?>">
                            <?php } ?>
                            <?php $parent = true; } ?>

                            <label><?php echo $this->translate($formElement->getLabel()); ?></label>
                            <div class="separator bottom"></div>
                            <?php echo $this->formElement($formElement); ?>
                            <div class="separator bottom"></div>

                            <?php if ($parent) $prev = $formElement; ?>
                            <?php } ?>

                            <?php if ($parent) { ?>
                            <a href="#" class="btn btn-icon btn-primary glyphicons circle_plus pull-right"
                               data-subform="<?php echo $prev->getAttribute('data-parent') ?>">
                                <?php echo $this->translate('Add subform'); ?></a>
                        </div></div>
                <?php } ?>

                </div>
                </fieldset>
                <?php } ?>

            </div>

            <div class="separator"></div>
            <div class="form-group" style="padding-right: 15px;">
                <button type="submit" class="btn btn-icon btn-primary glyphicons circle_ok pull-right"><i></i>
                    <?php echo $this->translate('don\'t click '); ?></button>
            </div>
        </div>
    </div>

    <?php echo $this->form()->closeTag($form); ?>

</div>


<script type="text/javascript">

    $(document).on('click', '[data-subform]', function(e){
        e.preventDefault();
        var subform = $('.surveyRepeat_' + $(this).data('subform'));

        var currentCount =  subform.length;
        var newCount = currentCount + 1;
        var lastRepeatingGroup = subform.last();

        var newSection = lastRepeatingGroup.clone();
        newSection.insertAfter(lastRepeatingGroup);

        newSection.find('input').each(function (index, input) {
            input.name = input.name.replace('[' + currentCount + ']', '[' + newCount + ']');
        });

        $(this).hide();
    });

</script>
